Bootstrap: library
From: ubuntu:latest

%post
    # Install necessary dependencies for OSU microbenchmarks
    apt-get -y update
    apt-get -y upgrade
    apt-get -y install gcc make file wget g++ libtool build-essential libibverbs-dev

    # Download and build OSU microbenchmarks
    wget http://mvapich.cse.ohio-state.edu/download/mvapich/osu-micro-benchmarks-7.2.tar.gz
    tar -zxvf osu-micro-benchmarks-7.2.tar.gz
    cd osu-micro-benchmarks-7.2
    ./configure CC=mpicc CXX=mpicxx
    make
    make install

%labels
    Name osu-microbenchmarks
    Version 7.2
    Author Armaan
    Description OSU Microbenchmarks

%environment
    export PATH=/osu-micro-benchmarks-7.2:$PATH

%help
    This Singularity container provides the OSU Microbenchmarks suite.
    You can run OSU benchmarks after launching this container.

%runscript
    mpirun -n 2 opt/osu/libexec/osu-micro-benchmarks-7.2/c/mpi/pt2pt/standard/osu_latency
